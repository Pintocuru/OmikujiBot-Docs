# プレースホルダー機能

メッセージ内で動的に内容を変化させるための機能です。配信状況やユーザー情報、ランダムな選択などをリアルタイムで反映できます。

## 📍 使用可能な場所

以下の設定項目内でプレースホルダーを使用できます：

- **おみくじ設定**
    - フキダシ内容
    - WordParty
- **定義済みプレースホルダー**
    - 登録する値（テキスト）の中

## 🔀 1. インライン・ランダム選択

個別の設定を作らずに、その場で簡易的なランダム抽選を行いたい場合に使用します。

### 基本構文

```javascript
<<'選択肢1','選択肢2','選択肢3'>>
```

### 使い方のポイント

- **選択肢の区切り**: 各選択肢をシングルクォート `' '` で囲み、カンマ `,` で区切ります
- **出現確率**: 重み付け（出現比率）の設定はできません。**すべて均等な確率**で抽選されます
- **ネスト可能**: 選択肢の中に、さらに別のプレースホルダーを含めることができます

### 使用例

```javascript
<<'こんにちは！','お久しぶりです！','よろしくお願いします！'>>

<<user>>さん、<<'お元気ですか？','調子はどうですか？'>>

<<'あら？<<user>>さん、初見かしら？','<<user>>さん、また会えたわね！'>>
```

## ⚙️ 2. 定義済みプレースホルダー

管理画面の「プレースホルダー」エディターで事前に設定する高度な抽選機能です。

### 基本概念

- **キー名で参照**: `<<キー名>>` の形式で使用します
    - 例: `<<lack>>`, `<<hello>>`
- **キー名の確認**: 「プレースホルダー」の 基本設定＞キーの名前を変更する から確認・変更できます
- **命名ルール**: 英数字のみ使用可能。**大文字・小文字を厳密に区別**します
    - `<<Foo>>` と `<<foo>>` は別物として扱われます

### 特徴と制限

1. **再帰的展開** : プレースホルダーの中に、さらに別のプレースホルダーを含めることができます
    - **最大 10 階層**まで繰り返し展開します
    - 例: `<<朝の挨拶>>` → `おはようございます、<<user>>さん！`
2. **確率調整** : 設定画面から各値の出現確率（重み）を調整できます
    - 例: 「大吉」50%、「吉」30%、「凶」20% など
3. **循環参照防止** : 自分自身を呼び出す等の循環参照が発生した場合、処理は自動的に停止します

### 注意点

- **パッケージ構成による差異**: 使用しているパッケージによっては、プレースホルダー機能が含まれない場合があります

---

## 📋 システム予約語（組み込みプレースホルダー）

以下のキー名はシステムであらかじめ定義されている予約語です。特別なデータを取得するために使用します。

### ⚠️ 重要注意事項

**定義済みプレースホルダーで下記の予約語と同じ「キー名」を作成した場合、予約語の機能は上書きされ、自作の設定が優先されます。**

### 共通で使用可能（コメントルール・タイマールール）

| 予約語             | 説明                             |
| --------------- | ------------------------------ |
| `<<viewer>>`    | 現在の同時接続視聴者数                    |
| `<<upVote>>`    | 高評価数（対応プラットフォームのみ）             |
| `<<commenter>>` | 配信内でコメントした累計ユニークユーザー数          |
| `<<winner>>`    | コメントしたユーザーの中からランダムに選ばれた 1 名の名前 |
| `<<null>>`      | 空文字。プレースホルダーで使用する、特殊な予約語です。    |

### コメントルール専用

**タイマールールで使用すると空文字が返ります**

| 予約語          | 説明                      | 補足                               |
| ------------ | ----------------------- | -------------------------------- |
| `<<user>>`   | ユーザー名                   | わんコメでニックネームが設定されている場合、そちらが優先されます |
| `<<userId>>` | ユーザーID                  | わんコメの設定で「除外ユーザー」などで指定できる識別文字列です  |
| `<<price>>`  | ギフト金額                   | メンバーシップなど金額が付かないものは `0` と表示されます  |
| `<<lc>>`     | 配信全体でのコメント通し番号          | Live Comment Number              |
| `<<tc>>`     | そのユーザーの累計コメント数          | Total Comments                   |
| `<<draws>>`  | 該当する「おみくじ」をそのユーザーが引いた回数 | -                                |

## 💡 使用例のまとめ

### 基本的な組み合わせ

```javascript
<<user>>さん、こんにちは！現在の視聴者数: <<viewer>>人
```

### インラインランダムの活用

```javascript
<<'おはようございます','こんにちは','こんばんは'>>、<<user>>さん！
```

### 定義済みプレースホルダーとの併用

```javascript
<<天気>>ですね。<<user>>さんは<<天気に応じた挨拶>>を持っていますか？
```

## 🔧 トラブルシューティング

| 現象               | 考えられる原因          | 対応方法              |
| ---------------- | ---------------- | ----------------- |
| プレースホルダーが展開されない  | キー名の大文字小文字が不一致   | 設定画面で正確なキー名を確認    |
| 予約語が機能しない        | 同名の自作プレースホルダーが存在 | キー名を変更するか、自作設定を削除 |
| タイマールールでユーザー情報が空 | コメントルール専用の予約語を使用 | 共通予約語のみを使用するよう修正  |