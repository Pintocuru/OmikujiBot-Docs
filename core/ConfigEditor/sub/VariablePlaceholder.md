## 変数プレースホルダー

### 概要

- **目的**: 変数の概念を導入し、より複雑で自由度の高いおみくじ結果を表示できるようにします。
- **特徴**: 簡易的なプログラミング要素を含みます。基本的な使い方はシンプルですが、応用的な使い方は少し複雑になる場合があります。
- **チートシート**: [VariablePlaceholderCheatSheet](VariablePlaceholderCheatSheet.md)

### 利用可能な場所

以下の設定項目内で使用できます。

- **各アクションセット** ＞ **おみくじ設定**
    - フキダシ内容
    - WordParty
- **プレースホルダー**

### 基本的な書式

使用したい機能を `{{ ... }}` のように**波括弧（`{}`）で二重に囲んで記述します**。

例: `{{rand(1,10)}}`, `{{var score=100}}`

---

### 機能一覧と詳細

#### 1. `var` - 変数の宣言・参照

**値を一時的に保存・再利用するための「変数」を扱います。**

- **変数宣言（値の保存）**
    - `{{var 変数名=値}}` の形式で記述します。
    - **変数名のルール**: 英数字が使用できます。先頭の文字は**英字**にしてください（JavaScript の命名規則に準拠）。
        - 例: `{{var userName='さくら'}}`, `{{var itemCount=5}}`
    - 一度宣言した変数は、**ブラウザ（または OBS）を閉じるまで保持され続けます**。これを活用することで、複数回のおみくじ結果を累積する「占いランキング」などが実現できます。
- **変数参照（値の取り出し）**
    - 宣言した変数名を `{{変数名}}` のように記述するだけで、保存された値に置き換わります。
        - 例: `こんにちは、{{userName}}さん！` → `こんにちは、さくらさん！`
- **変数の上書き**
    - 同じ変数名に対して再度 `{{var ...}}` を実行すると、値が新しいものに更新（上書き）されます。
        - 例: `{{var text='A'}}{{var text='B'}}{{text}}` → 結果は `B` となります。

#### 2. `rand` - ランダムな数値の生成

**指定した範囲内のランダムな整数を生成します。**

- **書式**: `{{rand(最小値, 最大値)}}`
- **説明**: 最小値から最大値の範囲内で、ランダムな整数を返します。
- **例**:
    - `{{rand(1, 100)}}` → `1` から `100` までのいずれかの整数
    - 数値以外が指定された場合は、空の値になります。

#### 3. `calc` - 数値の計算

**変数に基づいて加減乗除などの計算を行います。**

- **書式**: `{{calc 変数名 演算子 値}}`
- **対応する演算子**:
    - `+=` (加算), `-=` (減算), `*=` (乗算), `/=` (除算)
- **数値の範囲**:
    - 扱える数値の範囲は **-999,999,999 ～ 999,999,999** です。
        - `{{calc Foo = 5000000000000000}}{{Foo}}円欲しい!!`
        - → `999999999円欲しい!!` と表示されます
    - 小数点以下は **0.01** までが有効で、それ以下は丸められます。
    - この範囲を超える値は、上限値/下限値に丸められます。
- **計算例**:
    - `{{calc score += 10}}` → 変数 `score` の値に 10 を加算。
    - `{{calc total *= 2}}` → 変数 `total` の値を 2 倍（乗算）。
    - `{{calc point += rand(1, 5)}}` → `rand` と組み合わせてランダムな値を加算可能。

### 応用的な使い方とルール

#### 値の評価ルール (`var` の右辺)

`{{var 変数名=右辺の値}}` を記述した時、**右辺の値**は以下のルールで解釈されます。

1. **シングルクォート (`'`) またはダブルクォート (`"`) で囲まれた部分**
    
    - → **文字列** として扱われます。
    - 例: `{{var message="こんにちは"}}` → 値は文字列 `"こんにちは"`
        
2. **数値のみで構成され、クォートで囲まれていない部分**
    
    - → **数値** として扱われます。
    - 例: `{{var level=50}}` → 値は数値 `50`
        
3. **上記以外で、クォートで囲まれていない部分**
    
    - まず、**既存の変数名**として解釈されます。その変数が存在すれば、その値が代入されます。
    - 該当する変数が存在しなければ、**文字列**として扱われます。
    - 例:
        - `{{var source=100}}{{var target=source}}` → `target` の値は数値 `100`
        - `{{var unknown=foobar}}` （`foobar` という変数が未宣言の場合）→ `unknown` の値は文字列 `"foobar"`

#### 処理の順序と組み合わせ

1. **基本的な処理順序**: **プレースホルダー → 変数プレースホルダー**
    
    - 最初に通常のプレースホルダー（例: `<<ユーザー名>>`）が置き換えられ、その後で変数プレースホルダーの処理が行われます。
    - これにより、**プレースホルダーの結果を変数に保存することができます**。
        - 例: `{{var userId=<<ユーザーID>>}}` → `<<ユーザーID>>` が実際の ID に置き換えられてから、変数 `userId` に格納されます。
            
2. **変数名自体へのプレースホルダーの利用**
    
    - 変数名の部分にもプレースホルダーを使用できます。動的な変数名を生成する際に有用です。
        - 例: `{{var <<アイテム名>>=<<価格>>}}`

#### 予約語（特別な変数）

以下の変数名はシステムによって特別な意味を持つ**予約語**として扱われます。これらに値を代入することで、特定のアイテム（例: ランキング表示アイテム）に対して結果を渡すことができます。

- **予約語の一例**: `text`, `symbol`, `name`, `variant`, `unique`, `slot0` ～ `slot9`
- **注意点**:
    - 各予約語の役割は、**連携するアイテムによって異なります**。
    - アイテムによっては、特定の予約語が使用されない場合もあります。詳細は各アイテムの説明を参照してください。